# Generated by Cerberus
# Global options
{
    admin :2019
    auto_https off
}

# Default response for unmatched requests
:80 {
    respond /health "healthy" 200
    respond 404
}

# test-service - test.example.com
test.example.com:80 {
    # Logging
    log {
        output file /var/log/caddy/test-service_access.log
        format json
    }
    
    # Headers
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        -Server
    }
    encode gzip zstd
    reverse_proxy http://backend:3000 {
        header_up Host {host}
        header_up X-Real-IP {remote}
        header_up X-Forwarded-For {remote}
        header_up X-Forwarded-Proto {scheme}
        # WebSocket support
        header_up Upgrade {http.request.header.Upgrade}
        header_up Connection {http.request.header.Connection}
    }
}
